<!DOCTYPE html>
<script src="https://code.jquery.com/jquery-1.10.2.js"></script>

<html>

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title> 밥파스타 </title>
	
	<style>
		#div_container{
		}
		#div_root{
			border-bottom: thin solid #BEBEBE;
			padding: 5px;
			margin: auto;
			background-color: white;
			overflow: hidden;
		}
		#div_menu{
			width: 70%;
			float: left;
			<!-- padding-left: 5px; -->
			background-color: white;
			text-align: left;
		}
		#div_price_quantity{
			margin: auto;
			float: right;
			width: 30%;
			background-color: white;
		}
		#div_price{
			margin: auto;
			float: top;
			background-color: white;
			text-align: right;
		}
		#div_quantity{
			border: thin solid black;
			margin: auto;
			padding: 0px;
			float: right;
			background-color: white;
			height: 30px;
			width: auto;
		}
		#div_category_container{
		}
		.div_category{
			background-color: #F0F0F0;
			border-bottom: thin solid #BEBEBE;
			<!-- height: auto; -->
			width: auto;
		}
		#btn_minus{
			width: 20px;
			height: 30px;
			background-color: Transparent;
			border-style: none;
			border-right: thin solid black;
			text-align:center;
			padding: 0;
			margin: 0;
			float: left;
		}
		#btn_num{
			width: 40px;
			height: 30px;
			background-color: Transparent;
			border-style: none;
			pointer-events: none;
		}
		#btn_plus{
			width: 20px;
			height: 30px;
			background-color: Transparent;
			border-style: none;
			border-left: thin solid black;
			text-align: center;
			padding: 0;
			margin: 0;
			float: right;
		}

	</style>

</head>



<body>
<span style="font-weight:bold;">1번 테이블</span>

	<!-- <br> -->
	<!-- <img src='https://lh3.googleusercontent.com/5Pfothnh21Xsog37QyS2pxp6vf47YzTPu9d9eK-iPOSY5X3JqkfCZtUW8GVkS9eDFxBYeUf1Huzyf670hb0qAPyrfZoCUqL_jpqMvIX4EeZu-Al4dluoeSCLTfZSyunjmoCpbNra=w2400' alt="밥파스타 메뉴 사진" -->
		<!-- style="height:auto; width:100%;"	 -->
	<!-- /> -->
	<br>
	<!-- <span>** 추가 주문시 페이지를 새로고침 해주세요 **</span> -->

<p></p>
<div id="container">
	<div id="div_category_container">
		<div id="div_category1" class="div_category" num = 1 value = 0 title = "세트메뉴 &#x25BC">
		세트메뉴 &#x25BC
		<p>
		</p>
		</div>
		<div id="div_non_category1"></div>
		
		<div id="div_category2" class="div_category" num = 2 value = 0 title = "겨울메뉴 &#x25BC">
		겨울메뉴 &#x25BC
		<p>
		</p>
		</div>
		<div id="div_non_category2"></div>
		
		<div id="div_category3" class="div_category" num = 3 value = 0 title = "대표메뉴 &#x25BC">
		대표메뉴 &#x25BC
		<p>
		</p>
		</div>
		<div id="div_non_category3"></div>
		
		<div id="div_category4" class="div_category" num = 4 value = 0 title = "기본에 충실한 전요리 &#x25BC">
		기본에 충실한 전요리 &#x25BC
		<p>
		</p>
		</div>
		<div id="div_non_category4"></div>
		
		<div id="div_category5" class="div_category" num = 5 value = 0 title = "치즈덕후를 위한 100%자연치즈 듬뿍 &#x25BC">
		치즈덕후를 위한 100%자연치즈 듬뿍 &#x25BC
		<p>
		</p>
		</div>
		<div id="div_non_category5"></div>
		
		<div id="div_category6" class="div_category" num = 6 value = 0 title = "따뜻한 국물요리 &#x25BC">
		따뜻한 국물요리 &#x25BC
		<p>
		</p>
		</div>
		<div id="div_non_category6"></div>
		
		<div id="div_category7" class="div_category" num = 7 value = 0 title = "입가심 메뉴 &#x25BC">
		입가심 메뉴&#x25BC
		<p>
		</p>
		</div>
		<div id="div_non_category7"></div>
		
		<div id="div_category8" class="div_category" num = 8 value = 0 title = "추가메뉴 (다른메뉴와 함께 주문해주세요) &#x25BC">
		추가메뉴 (다른메뉴와 함께 주문해주세요) &#x25BC
		<p>
		</p>
		</div>
		<div id="div_non_category8"></div>
	</div>

	<p></p>
	<!-- <div style="border-bottom: thin solid #BEBEBE"> </div> -->


	<div id="orders" style="border-top:thick solid #BEBEBE; border-bottom: thick solid #BEBEBE; padding:5px">
	</div>
	<p></p>

	<span style="font-weight:bold"> 요청 사항 <input type="text", id="extraField" style="width:100%"> </input> </span>
	
<br><br>
<button id="order-btn"
		style = "display: block;
		  width: 100%;
		  height: 35px;
		  margin-left: 0;
		  margin-right: auto;
		  background: rgba(26,125,112,1);
		  font-size:93%;
	      font-family:sans-serif;
	      color: white;
		  "
>주문 및 결제</button>
	<!--div id="div_root"> 
		<div id="div_menu"> 알리오올리오 </div>
		<div id="div_price_quantity">
			<div id="div_price"> 16000원 </div>
			<div id="div_quantity">
				<button id="btn_minus"> - </button>
				<button id="btn_num"> 00 </button>
				<button id="btn_plus"> + </button>
			</div>
		</div>
	</div-->
</div>
</body>

<script>
	
	$('.div_category').click(function(){
		flag = $(this).attr("value");
		num = $(this).attr("num");
		if (flag == 0) {
			switch (num) {
				case '1':
					goods.drawGoods(goods.arrAllGoods, $('#div_non_category'+num), 0, 5);
					break;
				case '2':
					goods.drawGoods(goods.arrAllGoods, $('#div_non_category'+num), 6, 9);
					break;
				case '3':
					goods.drawGoods(goods.arrAllGoods, $('#div_non_category'+num), 10, 13);
					break;
				case '4':
					goods.drawGoods(goods.arrAllGoods, $('#div_non_category'+num), 14, 18);
					break;
				case '5':
					goods.drawGoods(goods.arrAllGoods, $('#div_non_category'+num), 19, 22);
					break;
				case '6':
					goods.drawGoods(goods.arrAllGoods, $('#div_non_category'+num), 23, 25);
					break;
				case '7':
					goods.drawGoods(goods.arrAllGoods, $('#div_non_category'+num), 26, 30);
					break;
				case '8':
					goods.drawGoods(goods.arrAllGoods, $('#div_non_category'+num), 31, 37);
					break;
				default:
					break;
			}

			$(this).attr("value", 1);
		}
		else {
			$('#div_non_category'+num).html('');
			$('#'+this.id).attr("value", 0);
		}
		
	});

	function Goods(){
		var tableNum = 1;
		var p = this;
		this.arrAllGoods = new Array();

		this.drawItem = function(goods, start, end) {
			var innerHtml = "";
			for (var i = start; i <= end; i++) {					
				innerHtml += '<div id="div_root">';
					innerHtml += '<div id="div_menu">'
						innerHtml += '<span id="input_name_'+goods[i].goodsId+'">' + goods[i].goodsNm + '</span>';
						if (goods[i].goodsSubname)
							innerHtml += '<br> <span style="font-size:80%; color:grey">' + goods[i].goodsSubname + '</span>';
						if (goods[i].goodsSubname2)
							innerHtml += '<br> <span style="font-size:80%; color:grey">' + goods[i].goodsSubname2 + '</span>';
					innerHtml += '</div>';
					innerHtml += '<div id="div_price_quantity">';
						innerHtml += '<div id="div_price">';
						innerHtml += '<span id="input_price_'+goods[i].goodsId+'">' + goods[i].goodsUnprc + '원</span>';
						innerHtml += '</div>';
						innerHtml += '<div id="div_quantity">';
						innerHtml += '<button id="btn_minus" onclick="goods.minus(\''+goods[i].goodsId+'\');"> - </button>';
						innerHtml += '<button id="btn_num">';

						//innerHtml += '<button id="btn_num">' + '<span id="input_cnt_'+goods[i].goodsId+'">' + goods[i].cnt + '</span> </button>';
						innerHtml += '<span id="input_cnt_'+goods[i].goodsId+'">' + goods[i].cnt + '</span>';
						innerHtml += '</button>';
						innerHtml += '<button  id="btn_plus" onclick=" goods.plus(\''+goods[i].goodsId+'\');"> + </button>';
						innerHtml += '</div>';
					innerHtml += '</div>';
				innerHtml += '</div>';
			}
			return innerHtml;
		}
		
		this.drawGoods = function(goods, category, start, end) {
			var innerHtml = "";
			//innerHtml += 
			innerHtml += this.drawItem(goods, start, end);
			$(category).append(innerHtml);

		}
		this.drawGoods2 = function(goods) {
			var innerHtml = "";
			//innerHtml += 
			innerHtml += this.drawItem(goods, 3, 5);
			$('#div_category2').append(innerHtml);

		}
		
		this.plus = function (trgtGoodsId){
			for(var i=0;i<p.arrAllGoods.length;i++){
				if(p.arrAllGoods[i].goodsId==trgtGoodsId){
					p.arrAllGoods[i].cnt++;
					break;
				}
			}
			
			p.afterProc();			
		}
		
		this.minus = function (trgtGoodsId){
			for(var i=0;i<p.arrAllGoods.length;i++){
				if(p.arrAllGoods[i].goodsId==trgtGoodsId){
					if(p.arrAllGoods[i].cnt==0) break;
					p.arrAllGoods[i].cnt--;
					break;
				}
			}
			
			p.afterProc();
		}
		
		var orderList = [];
		this.afterProc = function (){
			// 최종 금액 표시
			orderList = [];
			var goodsTotAmt = 0;
			for(var i=0; i<p.arrAllGoods.length; i++){
				$('#input_cnt_'+p.arrAllGoods[i].goodsId).html(p.arrAllGoods[i].cnt);
				if (p.arrAllGoods[i].cnt>0) {
					$('#input_name_'+p.arrAllGoods[i].goodsId).css("font-weight", "Bold");
					$('#input_cnt_'+p.arrAllGoods[i].goodsId).css("font-weight", "Bold");
				}
				else {
					$('#input_name_'+p.arrAllGoods[i].goodsId).css("font-weight", "Normal");
					$('#input_cnt_'+p.arrAllGoods[i].goodsId).css("font-weight", "Normal");
				}

				goodsTotAmt += p.arrAllGoods[i].cnt*p.arrAllGoods[i].goodsUnprc;
				if (p.arrAllGoods[i].cnt > 0) {
					orderList.push(p.arrAllGoods[i]);
				}
			}
			
			var innerHtml = "";
			innerHtml += '<div style="background-color: #F0F0F0; border-bottom: thin solid #BEBEBE">';
			innerHtml += '<span style="font-weight:bold; font-size:20px">주문 내역</span>';
			innerHtml += '</div>';
			innerHtml += '<br>';
			//innerHtml += '<ul class="columns" data-columns="1" style="padding-left:3; columns:1">';
			
			for (var i=0; i<orderList.length; i++){
				//innerHtml += '<li style="margin-left:3px">';
				innerHtml += '<div id="div_root">';
				innerHtml += '<span style="float: left">' + orderList[i].goodsNm + '</span>';
				innerHtml += '<span style="float: right">' + orderList[i].cnt + '개</span>';
				innerHtml += '</div>';
				//innerHtml += '</li>';
				innerHtml += '<br>';
			}
			//innerHtml += '</ul>';
			innerHtml += '<br>';
			innerHtml += '<div style="border-top:thin solid #BEBEBE"> </div>';
			innerHtml += '<span style="font-weight:bold; font-size:20px">주문 금액 </span>';
			innerHtml += '<span style="font-weight:bold; font-size:20px; float:right">' + goodsTotAmt + '원'+ '</span>';
			$('#orders').empty().append(innerHtml);
			
		}
		
		// sheet 에 insert 하는 부분
		var orderBtn = $('#order-btn');
		function isLoading(status){
		  if(status){
			$('html, body').addClass('wait');
			orderBtn.attr('disabled', true).html('주문중...');
		  } else {
			$('html, body').removeClass('wait');
			orderBtn.attr('disabled', false).html('주문 및 결제');
		  }
		}
		
		$('#order-btn').click(function(){
			isLoading(true);
			var totalAmount = 0;
			if (orderList.length == 0) {
				isLoading(false);
			} else{
				for (var i =0; i<orderList.length; i++) {
					var order = orderList[i];
					$.ajax({
						type: "GET",
						//url: "https://script.google.com/macros/s/AKfycbxJFXBRqM4_Y4E_w5qlI8QVmHd6HszYbqiyr65er5MEkGXA_0Eg/exec",
						data: {
						  "메뉴": order.goodsNm,
						  "개수": order.cnt,
						  "가격": order.goodsUnprc * order.cnt,
						  "테이블 번호": tableNum,
						},
						success: function (response) {
						  isLoading(false);
						  console.log(response);
						  $('#showData').html('');
						},
						error: function (request, status, error) {
						  console.log("error during doGet");
						  isLoading(false);
						  console.log("code:" + request.status + "\n" + "error:" + error);
						  console.log(request.responseText);
						}
					});
					totalAmount += order.cnt * order.goodsUnprc;
				}
			}
			if ($('#extraField').val()) {
				$.ajax({
					type: "GET",
					//url: "https://script.google.com/macros/s/AKfycbxJFXBRqM4_Y4E_w5qlI8QVmHd6HszYbqiyr65er5MEkGXA_0Eg/exec",
					data: {
					  "메뉴": $('#extraField').val(),
					  "개수": 0,
					  "가격": 0,
					  "테이블 번호": tableNum,
					},
					success: function (response) {
					  isLoading(false);
					  console.log(response);
					  $('#showData').html('');
					},
					error: function (request, status, error) {
					  console.log("error during doGet");
					  isLoading(false);
					  console.log("code:" + request.status + "\n" + "error:" + error);
					  console.log(request.responseText);
					}
				});
			}
			if (orderList.length > 0) {
				var amountHex = (totalAmount*Math.pow(2, 19)).toString(16);
				//location.href = 'kakaotalk://kakaopay/money/to/qr?qr_code=281006011118310251003045'+amountHex;
			}
		});
		
	}



	var goods = new Goods();
	
	//jstl로 전체 상품 목록 미리 세팅
	//세트메뉴
	goods.arrAllGoods.push({goodsId:"0",goodsUnprc:26000,goodsNm:"프리미엄 막걸리와 치즈전의 만남 (2인)", goodsSubname:"프리미엄막걸리 혹은 샴페인막걸리 + 모짜렐라김치전M 혹은 체다듬뿍감자전M", cnt:0});
	goods.arrAllGoods.push({goodsId:"1",goodsUnprc:26000,goodsNm:"모듬전과 반접시 굴무침 (2-3인)", cnt:0});
	goods.arrAllGoods.push({goodsId:"2",goodsUnprc:25000,goodsNm:"판타스틱4세트 (치즈전선택1+볶음류선택1) + 꿀토마토와 주먹밥", goodsSubname:"모짜렐라김치전, 체다듬뿍감자전, 불고기치즈파전(매운), 꿀고구마치즈전 중 선택1",
	                        goodsSubname2:"고추장불고기, 무뼈닭발볶음, 오돌뼈볶음 중 선택1", cnt:0});
	goods.arrAllGoods.push({goodsId:"3",goodsUnprc:20000,goodsNm:"치떡치떡세트 (치즈전+골라먹는떡볶이) (2인)", goodsSubname:"모짜렐라김치전, 체다듬뿍감자전, 불고기치즈파전, 옥수수치즈전, 꿀고구마치즈전 중 선택1", cnt:0});
	goods.arrAllGoods.push({goodsId:"4",goodsUnprc:15000,goodsNm:"내맘대로세트 두가지 (2인)", goodsSubname:"김치전, 채감자전, 부추전, 두부전, 새송이전, 애호박전, 깻잎전, 동태전, 고추전, 삼색꼬치 중 선택 2", cnt:0});
	goods.arrAllGoods.push({goodsId:"5",goodsUnprc:20000,goodsNm:"내맘대로세트 세가지 (3인)", goodsSubname:"김치전, 채감자전, 부추전, 두부전, 새송이전, 애호박전, 깻잎전, 동태전, 고추전, 삼색꼬치 중 선택 3", cnt:0});
	
	//겨울메뉴
	goods.arrAllGoods.push({goodsId:"6",goodsUnprc:16000,goodsNm:"생굴회", cnt:0});
	goods.arrAllGoods.push({goodsId:"7",goodsUnprc:16000,goodsNm:"굴전", cnt:0});
	goods.arrAllGoods.push({goodsId:"8",goodsUnprc:15000,goodsNm:"무채 굴무침", cnt:0});
	goods.arrAllGoods.push({goodsId:"9",goodsUnprc:25000,goodsNm:"홀닭홀닭 닭도리탕", cnt:0});

	//대표메뉴
	goods.arrAllGoods.push({goodsId:"10",goodsUnprc:19000,goodsNm:"모듬전", cnt:0});
	goods.arrAllGoods.push({goodsId:"11",goodsUnprc:15000,goodsNm:"두부와 볶음김치", cnt:0});
	goods.arrAllGoods.push({goodsId:"12",goodsUnprc:16000,goodsNm:"고쌈비빔면", cnt:0});
	goods.arrAllGoods.push({goodsId:"13",goodsUnprc:18000,goodsNm:"해물누룽지탕", cnt:0});
	
	//기본에 충실한 전요리
	goods.arrAllGoods.push({goodsId:"14",goodsUnprc:13000,goodsNm:"바삭한 채감자전", cnt:0});
	goods.arrAllGoods.push({goodsId:"15",goodsUnprc:12000,goodsNm:"김치전", cnt:0});
	goods.arrAllGoods.push({goodsId:"16",goodsUnprc:12000,goodsNm:"부추전", cnt:0});
	goods.arrAllGoods.push({goodsId:"17",goodsUnprc:16000,goodsNm:"지글지글 해물파전", cnt:0});
	goods.arrAllGoods.push({goodsId:"18",goodsUnprc:16000,goodsNm:"큼직큼직 새우전", cnt:0});
	
	//치즈덕후를 위한 100%자연치즈 듬뿍
	goods.arrAllGoods.push({goodsId:"19",goodsUnprc:17000,goodsNm:"모짜렐라김치전", cnt:0});
	goods.arrAllGoods.push({goodsId:"20",goodsUnprc:17000,goodsNm:"체다듬뿍감자전", cnt:0});
	goods.arrAllGoods.push({goodsId:"21",goodsUnprc:19000,goodsNm:"불고기치즈파전(매운)", cnt:0});
	goods.arrAllGoods.push({goodsId:"22",goodsUnprc:17000,goodsNm:"꿀고구마치즈전", cnt:0});
	
	//따뜻한 국물요리
	goods.arrAllGoods.push({goodsId:"23",goodsUnprc:15000,goodsNm:"개운한 어묵전골", cnt:0});
	goods.arrAllGoods.push({goodsId:"24",goodsUnprc:15000,goodsNm:"얼큰 김치찌개", cnt:0});
	goods.arrAllGoods.push({goodsId:"25",goodsUnprc:17000,goodsNm:"칼칼한 해물짬뽕탕", cnt:0});
	
	//입가심 메뉴
	goods.arrAllGoods.push({goodsId:"26",goodsUnprc:17000,goodsNm:"쫄깃한 무뼈닭발볶음", cnt:0});
	goods.arrAllGoods.push({goodsId:"27",goodsUnprc:15000,goodsNm:"오독오독 오돌뼈볶음", cnt:0});
	goods.arrAllGoods.push({goodsId:"28",goodsUnprc:16000,goodsNm:"고추장불고기", cnt:0});
	goods.arrAllGoods.push({goodsId:"29",goodsUnprc:19000,goodsNm:"골뱅이무침과 소면", cnt:0});
	goods.arrAllGoods.push({goodsId:"30",goodsUnprc:17000,goodsNm:"홍어무침(간재미무침)", cnt:0});
	
	//추가메뉴
	goods.arrAllGoods.push({goodsId:"31",goodsUnprc:13000,goodsNm:"골라먹는 떡볶이", cnt:0});
	goods.arrAllGoods.push({goodsId:"32",goodsUnprc:12000,goodsNm:"옛날소세지", cnt:0});
	goods.arrAllGoods.push({goodsId:"33",goodsUnprc:12000,goodsNm:"스팸구이와 계란후라이", cnt:0});
	goods.arrAllGoods.push({goodsId:"34",goodsUnprc:4500,goodsNm:"꿀덮은 토마토", cnt:0});
	goods.arrAllGoods.push({goodsId:"35",goodsUnprc:5000,goodsNm:"추억의도시락", cnt:0});
	goods.arrAllGoods.push({goodsId:"36",goodsUnprc:5500,goodsNm:"해물듬뿍라면", cnt:0});
	goods.arrAllGoods.push({goodsId:"37",goodsUnprc:3000,goodsNm:"주먹밥", cnt:0});

	goods.afterProc();
	//goods.drawGoods(goods.arrAllGoods);

</script>

</html>
